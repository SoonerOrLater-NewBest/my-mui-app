<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<title></title>
	<link rel="stylesheet" type="text/css" href="../../common/mui.min.css" />
	<link rel="stylesheet" type="text/css" href="../../common/common.css" />
	<link rel="stylesheet" type="text/css" href="word.css" />
	<script src="../../common/mui.min.js"></script>
	<script type="text/javascript" src="../../common/jquery-2.1.0.js"></script>
	<script src="../../common/common.js"></script>
</head>

<body>
	<!--下拉刷新容器-->
	<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
		<div class="mui-scroll">
			<!--数据列表-->
			<div class="newlist">
				<ul class="mui-table-view">

				</ul>
			</div>
		</div>
	</div>

	<script>
		mui.init({
			pullRefresh: {
				container: '#pullrefresh',
				down: {
					callback: pulldownRefresh
				},
				up: {
					contentrefresh: '正在加载...',
					callback: pullupRefresh
				}
			}
		});
		mui.plusReady(function() {
			//预加载详情页
			word_detail = mui.preload({
				url: 'word_detail.html',
				id: 'word_detail.html'
			});
		});
		//获取新闻列表
		var newlist_obj = null;
		$.ajax({
			type: "get",
			async: false,
			data: {
				type: 28,
				order: 'addtime desc'
			},
			url: api_url + "Api/get_case",
			dataType: "json",
			success: function(data) {
				newlist_obj = data;
			}
		});
		/**
		 * 下拉刷新具体业务实现
		 */
		function pulldownRefresh() {
			setTimeout(function() {
				mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
			}, 1500);
		}
		/**
		 * 上拉加载具体业务实现
		 */
		var count = newlist_obj.length;
		var count2 = 10;

		function pullupRefresh() {
			setTimeout(function() {
				if(count > 0) {
					if(count < 10) {
						count2 = count;
					}
					mui('#pullrefresh').pullRefresh().endPullupToRefresh(); //参数为true代表没有更多数据了。	
					var table = document.body.querySelector('.mui-table-view');
					var cells = document.body.querySelectorAll('.mui-table-view-cell');
					//		console.log(newlist_obj);
					var html = '';
					for(var i = cells.length, len = i + count2; i < len; i++) {
						var addtime = newlist_obj[i]['addtime'].substring(0, 10);
						html += '<li class="mui-table-view-cell mui-media">' +
							'<a href="javascript:;" id="' + newlist_obj[i]['z_id'] + '" isouturl="' + newlist_obj[i]['is_out_url'] + '" outurl="' + newlist_obj[i]['out_url'] + '" title="' + newlist_obj[i]['title'] + '">' +
							'<img class="mui-media-object mui-pull-left" src="' + newlist_obj[i]['main_imgs'] + '">' +
							'<div class="mui-media-body">' +
							'<h2 class="mui-ellipsis">' + newlist_obj[i]['title'] + '</h2>' +
							'<p class="mui-ellipsis">来自<span>' + newlist_obj[i]['author'] + '</span><span class="new_date mui-pull-right">' + addtime + '</span></p>' +
							'</div>' +
							'</a>' +
							'</li>';
					}
					$('.newlist .mui-table-view').append(html);
					count = count - 10;
				} else {
					mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);
				}
			}, 500);
		}
		if(mui.os.plus) {
			mui.plusReady(function() {
				setTimeout(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
				}, 10);

			});
		} else {
			mui.ready(function() {
				mui('#pullrefresh').pullRefresh().pullupLoading();
			});
		}
		mui.plusReady(function() {
			//添加列表项的点击事件
			mui('.newlist').on('tap', 'a', function(e) {
				var id = this.getAttribute('id');
				var isouturl = this.getAttribute('isouturl');
				var outurl = this.getAttribute('outurl');
				var title = this.getAttribute('title');
				mui.fire(news_detail, 'get_detail', {
					id: id,
					isouturl: isouturl,
					outurl: outurl,
					title: title
				});
				//获得打开详情页面
				setTimeout(function() {
					word_detail.show("slide-in-right", 300);
				}, 50);
			});
		})
		
	</script>
</body>
</html>